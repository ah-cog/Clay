#define GESTURE_COUNT 9
#define AXIS_COUNT 3
#define GESTURE_SIGNATURE_MAXIMUM_SIZE 35
#define GESTURE_CANDIDATE_SIZE 35 // The number of most recent live data points to store

int classifiedGestureIndex = 0;
int previousClassifiedGestureIndex = -1;
unsigned long lastGestureClassificationTime = 0L; // Time of last gesture classification

char* gestureName[GESTURE_COUNT] = {
	"at rest",
	"swing",
	"tap to another, as left",
	"tap to another, as right",
	"shake",
	"tilt left",
	"tilt right",
	"tilt forward",
	"tilt backward"
};

int gestureSignatureSize[] = { 35, 35, 35, 35, 35, 35, 35, 35, 35 };

int gestureSustainDuration[GESTURE_COUNT] = {
	0, // "at rest"
	600, // "swing"
	800, // "tap to another, as left"
	800,  // "tap to another, as right"
	200, // "shake"
	0, // "tilt left"
	0, // "tilt right"
	0, // "tilt forward"
	0 // "tilt backward"
};

int gestureTransitions[GESTURE_COUNT][GESTURE_COUNT] = {
	{ 0, 1, 5, 6, 7, 8, 2, 3, 4 },
	{ 0, 4, 5, 6, 7, 8, 2, 3, -1 },
	{ 0, -1, -1, -1, -1, -1, -1, -1, -1 },
	{ 0, -1, -1, -1, -1, -1, -1, -1, -1 },
	{ 4, 0, -1, -1, -1, -1, -1, -1, -1 },
	{ 5, 0, -1, -1, -1, -1, -1, -1, -1 },
	{ 6, 0, -1, -1, -1, -1, -1, -1, -1 },
	{ 7, 0, -1, -1, -1, -1, -1, -1, -1 },
	{ 8, 0, -1, -1, -1, -1, -1, -1, -1 }
};
int gestureCandidateSize = 0; // Current size of the live gesture data
int gestureCandidate[AXIS_COUNT][GESTURE_CANDIDATE_SIZE] = {
	{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
	{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
	{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }
};


int gestureSampleCount = 0;
int gestureSensorSampleCount = 0;
int gestureSignature[GESTURE_COUNT][AXIS_COUNT][GESTURE_SIGNATURE_MAXIMUM_SIZE] = {
	{
		{ 8, 8, 8, 7, 7, 8, 7, 8, 7, 8, 8, 8, 8, 8, 8, 9, 9, 8, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 10, 9, 8 },
		{ 7, 7, 8, 7, 7, 7, 8, 7, 7, 8, 7, 7, 8, 9, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 8, 8, 8, 8, 8, 8, 9 },
		{ 246, 247, 246, 246, 246, 247, 247, 246, 246, 246, 246, 246, 246, 246, 247, 247, 248, 247, 246, 246, 246, 246, 246, 246, 246, 247, 246, 246, 245, 246, 247, 247, 248, 247, 248 }
	},
	{
		{ -180, -179, -177, -173, -156, -125, -105, -94, -27, 31, 191, 294, 414, 467, 411, 339, 240, 159, 90, 39, 17, 10, 2, 2, 8, 8, -10, -10, -10, -10, -10, -10, -10, -10, -10 },
		{ 4, 6, 5, 3, 0, -9, -22, -28, -42, -48, -53, -7, 37, 17, 53, 73, 51, 24, 13, 13, 11, 6, 1, 6, 8, 13, 42, 42, 42, 42, 42, 42, 42, 42, 42 },
		{ 152, 152, 149, 136, 107, 36, -72, -352, -446, -424, -298, 43, 379, 566, 694, 672, 666, 554, 477, 403, 342, 308, 260, 227, 225, 237, 247, 247, 247, 247, 247, 247, 247, 247, 247 }
	},
	{
		{ 19, 20, 20, 22, 23, 24, 24, 21, 19, 17, 15, 14, 13, 14, 16, 17, 21, 23, 27, 34, 37, 45, 61, 48, -41, -20, -56, -84, -46, -5, 4, 4, -7, -8, -10 },
		{ 5, 0, -4, -22, -36, -44, -42, -41, -38, -23, 0, 16, 34, 54, 74, 88, 111, 128, 145, 161, 169, 169, 166, 93, -130, -18, 38, 0, -26, -41, -49, -56, -40, -14, -4 },
		{ 244, 253, 256, 269, 280, 285, 284, 280, 277, 268, 255, 246, 242, 236, 232, 230, 225, 222, 217, 215, 213, 214, 216, 299, 70, 175, 225, 236, 220, 229, 229, 214, 207, 205, 205 }
	},
	{
		{ 23, 25, 25, 25, 27, 28, 28, 28, 26, 27, 32, 32, 32, 35, 37, 42, 43, 39, 49, 47, 48, 50, 52, 56, 68, 87, -163, 27, -12, -19, -29, -25, -28, -19, -8 },
		{ 16, 18, 22, 28, 39, 46, 55, 62, 63, 55, 39, 27, 9, -13, -34, -76, -106, -122, -137, -152, -168, -180, -182, -191, -198, -175, 25, 102, 154, 144, 168, 172, 154, 99, 41 },
		{ 244, 248, 253, 259, 266, 271, 277, 282, 282, 275, 267, 265, 257, 247, 241, 227, 219, 215, 214, 209, 195, 180, 176, 168, 165, 117, 163, 188, 249, 268, 248, 206, 196, 192, 192 }
	},
	{
		{ 68, 99, 119, 118, 112, 85, 61, 14, -97, -120, -104, -5, 67, 188, 301, 250, 206, 148, 104, -13, -87, -67, -14, 96, 87, 112, 196, 126, 126, 72, 17, -63, -61, 100, 75 },
		{ 19, 7, -1, 0, -2, -14, -15, -40, -36, -23, -30, 6, 27, 33, -8, -42, -31, -57, -61, -18, 14, 7, 15, 56, 63, 21, -40, -31, -27, -26, -11, 13, 21, 24, 40 },
		{ 348, 407, 439, 429, 404, 304, 228, 55, -200, -216, -255, -176, -12, 409, 588, 667, 616, 464, 322, 63, -77, -98, -48, 143, 236, 403, 484, 367, 489, 326, 181, 3, -66, 157, 39 }
	},
	{
		{ 0, 0, 0, 0, 1, 2, 4, 4, 1, -2, -11, -12, -12, -14, -18, -19, -17, -17, -17, -17, -16, -16, -14, -13, -13, -12, -12, -13, -13, -11, -11, -12, -12, -13, -16 },
		{ 22, 23, 22, 22, 21, 21, 16, 12, 13, 36, 77, 93, 123, 144, 159, 169, 167, 164, 166, 170, 170, 168, 165, 164, 163, 164, 167, 169, 168, 165, 165, 164, 196, 196, 183 },
		{ 251, 250, 250, 251, 250, 249, 246, 236, 230, 219, 203, 199, 188, 172, 158, 146, 138, 136, 134, 132, 130, 128, 127, 129, 128, 129, 130, 131, 131, 133, 134, 134, 109, 110, 116 }
	},
	{
		{ 4, 4, 3, 4, 3, 4, 4, 4, 4, 5, 6, 8, 10, 9, 4, 0, 1, 2, 2, -1, -3, -6, -7, -8, -9, -8, -8, -7, -8, -7, -8, -7, -7, -7, -7 },
		{ 16, 16, 17, 17, 17, 17, 19, 19, 17, 17, 18, 16, 9, -2, -17, -39, -38, -60, -87, -110, -128, -135, -146, -164, -178, -184, -188, -189, -190, -190, -189, -189, -189, -189, -189 },
		{ 250, 250, 251, 251, 251, 250, 251, 251, 250, 256, 262, 271, 265, 254, 244, 226, 226, 197, 170, 156, 137, 128, 117, 104, 91, 85, 85, 85, 86, 84, 81, 83, 84, 82, 81 }
	},
	{
		{ -6, -6, -3, -6, -8, -9, -9, -5, -3, 0, 11, 20, 33, 47, 62, 82, 96, 112, 139, 164, 175, 185, 196, 197, 199, 202, 203, 202, 199, 199, 200, 200, 200, 199, 196 },
		{ -4, -4, -7, -5, -5, -4, -3, -3, -4, -2, -1, 1, 2, 0, -1, -4, -1, -1, -5, -7, -7, -9, -7, -8, -7, -10, -8, -7, -6, -5, -4, -4, -5, -4, -4 },
		{ 249, 247, 250, 250, 249, 248, 249, 246, 243, 234, 224, 222, 224, 219, 216, 204, 188, 166, 154, 146, 137, 126, 117, 105, 96, 96, 96, 93, 85, 83, 81, 79, 78, 75, 75 }
	},
	{
		{ 20, 22, 26, 29, 31, 32, 24, 15, 0, -14, -29, -40, -43, -74, -83, -101, -127, -146, -162, -170, -171, -169, -175, -180, -191, -193, -196, -196, -201, -204, -208, -210, -209, -208, -207 },
		{ -12, -12, -14, -15, -16, -18, -18, -15, -16, -17, -13, -17, -15, -9, -7, -7, -4, -3, -2, -1, -4, -7, -10, -7, -9, -8, -9, -9, -6, -6, -7, -7, -6, -6, -7 },
		{ 245, 247, 252, 258, 258, 259, 250, 251, 251, 247, 241, 242, 238, 215, 209, 197, 186, 167, 142, 127, 120, 117, 107, 97, 86, 77, 70, 70, 67, 70, 71, 65, 61, 61, 63 }
	}
};
